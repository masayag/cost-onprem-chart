[pytest]
testpaths = suites
python_files = test_*.py
python_classes = Test*
python_functions = test_*
addopts =
    -v
    --tb=short
    --strict-markers
    --junit-xml=reports/junit.xml
    -m "not extended and not multi_cluster"

# =============================================================================
# Test Markers
# =============================================================================
# Use markers to organize tests into logical groups that can be run independently
# or in combination.
#
# Run examples:
#   pytest -m smoke                    # Quick validation tests
#   pytest -m "helm"                   # Helm chart tests only
#   pytest -m "auth"                   # Authentication tests only
#   pytest -m "infrastructure"         # Infrastructure health tests
#   pytest -m "cost_management"        # Koku pipeline tests
#   pytest -m "ros"                    # ROS/Kruize tests
#   pytest -m "e2e"                    # End-to-end tests
#   pytest -m "scenario"               # YAML-driven scenario tests
#   pytest -m "not slow"               # Skip slow tests
#   pytest -m "smoke and auth"         # Smoke tests in auth suite
#   pytest suites/helm/                # Run entire helm suite
#   pytest suites/e2e/ -m smoke        # E2E smoke tests only
#
# Test type filtering:
#   pytest -m component                # Single-component tests
#   pytest -m integration              # Multi-component tests
#   pytest -m "component and helm"     # Component tests in helm suite
#   pytest -m "integration and auth"   # Integration tests in auth suite
#
# Extended tests (skipped by default, require longer processing):
#   pytest -m extended                 # Run ONLY extended tests
#   pytest -m "e2e and not extended"   # E2E tests excluding extended (default CI)
#   pytest                             # All tests EXCEPT extended and multi_cluster (default)
#
# Multi-cluster tests (skipped by default, generate data for multiple clusters):
#   pytest -m multi_cluster --cluster-count 3    # Run with 3 clusters
#   pytest -m multi_cluster --cluster-count 5    # Run with 5 clusters
#   ./scripts/run-pytest.sh --multi-cluster 3    # Via wrapper script
#
# New test categories:
#   pytest -m scenario                 # YAML-driven scenario tests (35 tests)
#   pytest suites/infrastructure/test_kafka.py    # Kafka validation
#   pytest suites/infrastructure/test_storage.py  # S3/Storage preflight
#   pytest suites/cost_management/test_cost_validation.py     # Cost validation
#   pytest suites/cost_management/test_processing_state.py    # Processing state
# =============================================================================

markers =
    # Suite markers (one per test file/class)
    helm: Helm chart validation tests (lint, template, deployment health)
    auth: JWT authentication tests (Keycloak, ingress, backend)
    infrastructure: Infrastructure health tests (DB, S3, Kafka, storage)
    cost_management: Cost Management (Koku) pipeline tests
    ros: ROS/Kruize recommendation tests
    e2e: End-to-end cross-suite tests
    
    # Test type markers
    component: Tests that validate a single component in isolation
    integration: Tests that validate interactions between multiple components
    
    # Cross-cutting markers (can be combined with suite markers)
    smoke: Quick smoke tests for basic functionality validation
    slow: Tests that take longer to run (processing, recommendations)
    extended: Tests requiring extended processing time (skipped by default in CI, run with -m extended)
    multi_cluster: Multi-cluster data generation tests (skipped by default, run with --multi-cluster)
    scenario: YAML-driven scenario tests for different workload patterns
    cost_validation: Cost calculation validation tests (metrics, tolerances)

# Timeout for individual tests (seconds)
timeout = 300

# Filter warnings
filterwarnings =
    ignore::DeprecationWarning
    ignore::urllib3.exceptions.InsecureRequestWarning

# Add tests directory to Python path for imports
pythonpath = .